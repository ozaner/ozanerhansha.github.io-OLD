<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>
    
      Compression, Images, and FileToPNG &middot; Ozaner
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- Load JQuery (JavaScript)-->
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      positionToHash: true,
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$', '$$']],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      messageStyle: "none",
      "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        styles: {".MathJax": {color: "#CCCCCC"}}
      },
      displayAlign: "center!important",
      displayIndent: "0em"
    });
    MathJax.Hub.Queue(function() {
      // Fix <code> tags after MathJax finishes running. This is a
      // hack to overcome a shortcoming of Markdown. Discussion at
      // https://github.com/mojombo/jekyll/issues/199
      var all = MathJax.Hub.getAllJax(), i;
      for(i = 0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  <!-- Adds MathJax -->
  <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <!-- Adds Awesome Icons-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Collects tags of all posts-->
  
    






  

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111962015-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-111962015-1');
  </script>
</head>

  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          $$\large{\text {Oz}}\tiny{\underbrace{\large {\text {∀n∈ℝ}}}_{\tiny {\text {For all real n...}}}}$$
        </a>
      </h1>
      <p class="lead">A compilation of my notes, projects, and articles.</p>
    </div>

    <nav class="sidebar-nav">
      <a href="https://medium.com/@ozanerhansha" target="_blank">Articles</a><br/>

      

      
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/notes/">Notes</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/projects/">Projects</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/references/">Interesting References</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <style>
        p.small {
            line-height: 0.7;
        }
      </style>

      <br>

      <p class="small">
        <!--- Icon Links -->
        <b>Links: </b>
        <a href="https://github.com/ozanerhansha"><i class='fa fa-github'></i></a>
        <!-- <a href="https://www.quora.com/profile/Ozaner-Hansha/questions"><i class='fa fa-quora'></i></a> -->
        <a href="https://medium.com/@ozanerhansha"<i class='fa fa-medium'></i></a>
        <!-- <a href="https://math.stackexchange.com/users/490433/ozaner-hansha?tab=questions"><i class='fa fa-stack-exchange'></i></a> -->

        <br>
        <font size="2"><a href="https://github.com/ozanerhansha/ozanerhansha.github.io">This Website's Code</a></font>
      </p>
    </nav>
    <p>2018 Ozaner Hansha</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Compression, Images, and FileToPNG</h1>
  <span class="post-date">16 Jan 2018</span>
  <span>[
  
    
    <a href="/tag/computer-science"><code class="highligher-rouge"><nobr>computer-science</nobr></code>&nbsp;</a>
  
    
    <a href="/tag/projects"><code class="highligher-rouge"><nobr>projects</nobr></code>&nbsp;</a>
  
]</span>
  <h2 id="what-is-filetopng">What is FileToPNG?</h2>
<p>FileToPNG is a tool I wrote in Java that converts the raw binary representation of any file into a corresponding PNG image representation. The resulting PNG (being a lossless file type) can be sent through text, email, etc. before finally being reconstructed back into its original form.</p>

<p>The project’s GitHub repository can be found <a href="https://github.com/ozanerhansha/FileToPNG">here</a>.</p>

<p>While FileToPNG’s main purpose was to be a tool that allowed for the sending of files over image only communication channels, I’ve found that, based on what type of files are put into it, the resulting images show some interesting patterns. I will elaborate on a couple of these findings in this post.</p>

<!--more-->

<h2 id="the-main-algorithm">The Main Algorithm</h2>
<p>While I have programmed a primitive UI (the code for which can be found <a href="https://github.com/ozanerhansha/FileToPNG/blob/master/src/Main.java">here</a>) to make using the tool easier, it’s not the main focus of FileToPNG and is really just boilerplate Java.</p>

<p>The real meat of the program is the conversion functions for PNG to File and vice versa. The code for this can be found <a href="https://github.com/ozanerhansha/FileToPNG/blob/master/src/GFile.java">here</a></p>

<p>The algorithm goes something like this:</p>
<ol>
  <li>Convert the file into a string of bytes (8 bits = 1 byte).</li>
  <li>Read through this list and make a pixel out of every 3 bytes. This can be done because a pixel is comprised of 3 colors (red, green, and blue) each with a value from 0-255. These 256 values can be represented in 8 bits (because 2<sup>8</sup>=256).</li>
  <li>Once a list of pixels (which should be about a 1/3 of the size of the byte list) has been made, create a square image (in .png format) out of these pixels.</li>
  <li>Account for files whose bytes aren’t a multiple of 3. (I used special ‘2 byte’ and ‘1 byte’ pixels that have different alpha values to demarcate them)</li>
</ol>

<p>Reconstructing the images into files is as simple as reversing this process.</p>

<h4 id="side-note-on-function-mapping">Side Note on Function Mapping</h4>
<p>You can think of the program as a function that maps the set of all <a href="https://en.wikipedia.org/wiki/Kleene_star">finite bit strings</a> to the set of all square images. Because this image is a square of pixels with 4 layers (red, green, blue, and alpha) we can represent it as the set of all rank 3 tensors with size $n\times n\times 4$ and integer elements from $0$ to $255$:</p>

<script type="math/tex; mode=display">\text{FileToPNG}:\{0,1\}^+\to \left(\mathbb{N}_{255}\right)^{n\times n\times 4}</script>

<h4 id="side-note-on-exclusion-of-alpha-channel">Side Note on Exclusion of Alpha Channel</h4>
<p>You may notice that while .png files have 4 color channels (red, green, blue and alpha), I only use 3 to store the data of the file and leave the alpha channel to indicate whether a given pixel only holds 1 or 2 bytes of information rather than 3.</p>

<p>This is obviously inefficient and I’m sure there are better ways of representing the file as a png while simultaneously taking advantage of all 4 channels, effectively saving 25% more space for each pixel. One way to do this might have to do with the dimensions of the image. There is no reason for the image to be a square.</p>

<p>I haven’t don anything about this because, in its current state, the algorithm is better suited to exploring the representations of the data it encodes rather than efficiently compressing them in image form. Having the alpha channel available would make the resulting images (and information they represent) harder to visualize.</p>

<h2 id="properties-of-png-representations">Properties of PNG Representations</h2>
<p>FileToPNG doesn’t do any sort of encrypting or compression of the file’s data (as of yet). As such, the PNG representation it spits out can give us an unfiltered look at the file’s structure.</p>

<h3 id="text-files">Text Files</h3>
<p>Take text files for example. Their content, of course, varies widely depending on the length and topic of discussion. But, even if they don’t use the same language, they all still use the same set of Unicode characters which all have the same configuration of bits. Meaning they share some similarities:</p>

<p><img src="/assets/projects/filetopng/text_diagram.png?style=centerme" alt="Text in FileToPNG" width="500px" /></p>

<h3 id="music-files">Music Files</h3>
<p>This one was kind of surprising. When I took an .mp3 file of a song and put it through the program, the resulting image was seemingly random:</p>

<!-- ![mp3](/assets/projects/filetopng/song_mp3.png?style=centerme){:width="300px"}

### 1MB file of random noise for comparison:
![Random Noise](/assets/projects/filetopng/random_data.png?style=centerme){:width="300px"} -->

<p><img src="/assets/projects/filetopng/random_music.png?style=centerme" alt="mp3" width="700px" /></p>

<p>I was disappointed at first, but then I realized that randomness is fundamentally information packed. That is to say, if the PNG representation had some sort of overarching structure, then that would imply that there is still some redundancy in the file that could be compressed, thereby making the file smaller and more random looking.</p>

<p>This lines up with the fact that mp3 files are <strong>lossy</strong> (i.e they sacrifice perfect quality for a smaller size).</p>

<!-- ![xkcd](https://imgs.xkcd.com/comics/digital_data.png?style=centerme){:width="600px"}
<center><i>Relevant xckd</i></center> -->

<p>The natural step forward at that point was to get a .wav version of the song, which is <strong>lossless</strong>, and see if it had any structure. And, as expected, it did:</p>

<p><img src="/assets/projects/filetopng/song_wav.png?style=centerme" alt="wav" width="600px" /></p>

<p>Note the repeating bands of different ‘frequencies.’ The image was also much bigger in area due to being lossless (the size difference isn’t reflected here because the image would extend out of the webpage).</p>

<h4 id="qualitative-measure-of-information-density">Qualitative Measure of Information Density</h4>
<p>It is in this way that we can examine how “densely packed” with information a given file is. If we see patterns in the colors or structure of the image, we know there can be more compression done. However, if the image is indistinguishable from random noise, then it’s probably rich in information.</p>

<h3 id="nintendo-64-roms">Nintendo 64 ROMs</h3>
<p>As a final test, I thought I would try converting a couple of Nintendo 64 games (in file form) that were on my desktop to PNGs and, unsurprisingly, they share many similarities:</p>

<p><img src="/assets/projects/filetopng/n64_diagram.png?style=centerme" alt="N64 Roms in FileToPNG" width="500px" /></p>

<p>Interested, I did some research into N64 cartridges and found out that all ‘ROM dumps’ (files that were created by copying a physical N64 cartridge onto a computer) have what’s called a <em>header</em>. This header includes custodial information like the game’s version, internal name, and other bits of information that might be interesting to a game historian. These headers are the black boxes at the top of <em>Super Mario 64</em> and <em>Mario Kart 64</em> respectively.</p>

<p>You may also notice that the <em>Super Mario 64</em> rom is smaller than the <em>Mario Kart 64</em> one, implying that it has a smaller file size. Apparently, N64 games came on a variety of hardware with different storage capacities and capabilities. This may seem normal nowadays but in an era where all games had to work on the same piece of limited hardware, this variability is pretty amazing.</p>

<p>Another similarity can be spotted after the last black bar, at then bottom of the images. Past this point, both the ROMs consist of ‘garbage data’ meant to fill up the game cartridge they were stored on. You can tell because this section looks more like the random sample then the rest of the picture.</p>

<!-- ![xkcd](https://imgs.xkcd.com/comics/file_extensions.png?style=centerme)
<center><i>Relevant xckd</i></center> -->

<!-- ![xkcd](https://imgs.xkcd.com/comics/porn.png?style=centerme)
<center><i>Relevant xckd</i></center> -->

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/classical-computation-in-linear-algebra/">
            Classical Computation in Linear Algebra
            <small>14 Jul 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/letter-case/">
            Letter Case and Computing
            <small>05 Jul 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/hello-world/">
            On the Origin of "Hello, World!"
            <small>25 Jun 2018</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
  </body>
</html>
